<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}"
      lang="ko">
<head>
    <title>리뷰 수정</title>
    <th:block layout:fragment="css">
        <style>
            .review-container {
                max-width: 800px;
                margin: 50px auto;
                padding: 40px;
                background: #fff;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }
            
            .review-header {
                margin-bottom: 30px;
                padding-bottom: 20px;
                border-bottom: 2px solid #e8e8e8;
            }
            
            .review-header h1 {
                font-size: 24px;
                font-weight: 700;
                color: #232f3e;
                margin-bottom: 15px;
            }
            
            .product-info {
                display: flex;
                gap: 15px;
                align-items: center;
            }
            
            .product-image {
                width: 80px;
                height: 80px;
                border: 1px solid #e8e8e8;
                border-radius: 4px;
                overflow: hidden;
            }
            
            .product-image img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            
            .product-name {
                font-size: 16px;
                font-weight: 600;
                color: #333;
            }
            
            .form-group {
                margin-bottom: 25px;
            }
            
            .form-group label {
                display: block;
                font-weight: 600;
                color: #333;
                margin-bottom: 10px;
                font-size: 15px;
            }
            
            .required {
                color: #E31837;
            }
            
            /* 별점 선택 */
            .rating-input {
                display: flex;
                gap: 10px;
                flex-direction: row-reverse;
                justify-content: flex-end;
            }
            
            .rating-input input[type="radio"] {
                display: none;
            }
            
            .rating-input label {
                cursor: pointer;
                font-size: 40px;
                color: #ddd;
                transition: color 0.2s;
                margin: 0;
            }
            
            .rating-input label:hover,
            .rating-input label:hover ~ label,
            .rating-input input[type="radio"]:checked ~ label {
                color: #ff9900;
            }
            
            .rating-desc {
                margin-top: 10px;
                font-size: 14px;
                color: #666;
            }
            
            .form-control {
                width: 100%;
                padding: 12px 15px;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-size: 14px;
                transition: all 0.3s;
                box-sizing: border-box;
            }
            
            .form-control:focus {
                outline: none;
                border-color: #ff9900;
                box-shadow: 0 0 0 3px rgba(255, 153, 0, 0.1);
            }
            
            .form-control.textarea {
                min-height: 150px;
                resize: vertical;
                font-family: inherit;
            }
            
            .file-upload-wrapper {
                position: relative;
            }
            
            .file-upload-btn {
                display: inline-block;
                padding: 12px 20px;
                background: #f0f0f0;
                border: 1px solid #ddd;
                border-radius: 4px;
                cursor: pointer;
                transition: all 0.3s;
            }
            
            .file-upload-btn:hover {
                background: #e8e8e8;
            }
            
            .file-upload-wrapper input[type=file] {
                position: absolute;
                left: -9999px;
            }
            
            .file-name {
                margin-top: 10px;
                font-size: 13px;
                color: #666;
            }
            
            .image-preview {
                margin-top: 15px;
                max-width: 300px;
                border: 1px solid #ddd;
                border-radius: 4px;
                overflow: hidden;
            }
            
            .image-preview img {
                width: 100%;
                height: auto;
            }
            
            .help-text {
                font-size: 12px;
                color: #999;
                margin-top: 5px;
            }
            
            .form-actions {
                display: flex;
                gap: 15px;
                margin-top: 40px;
                justify-content: center;
            }
            
            .btn {
                padding: 14px 40px;
                border: none;
                border-radius: 4px;
                font-size: 15px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s;
            }
            
            .btn-primary {
                background: #ff9900;
                color: #fff;
            }
            
            .btn-primary:hover {
                background: #e88b00;
            }
            
            .btn-secondary {
                background: #e7e9ec;
                color: #333;
            }
            
            .btn-secondary:hover {
                background: #d5d9dd;
            }
        </style>
    </th:block>
</head>
<body>
    <main layout:fragment="content">
        <div class="review-container">
            <div class="review-header">
                <h1>리뷰 수정</h1>
                <div class="product-info">
                    <div class="product-image">
                        <img th:src="${product.repImageUrl != null ? product.repImageUrl : '/images/product-sample.jpg'}" 
                             alt="상품">
                    </div>
                    <div class="product-name" th:text="${product.productName}">상품명</div>
                </div>
            </div>
            
            <form th:action="@{/review/edit/{id}(id=${review.id})}" method="post" enctype="multipart/form-data" id="reviewForm">
                <input type="hidden" name="productId" th:value="${product.id}">
                
                <!-- 별점 선택 -->
                <div class="form-group">
                    <label>별점<span class="required">*</span></label>
                    <div class="rating-input">
                        <input type="radio" id="star5" name="rating" value="5" th:checked="${review.rating == 5}" required>
                        <label for="star5">★</label>
                        
                        <input type="radio" id="star4" name="rating" value="4" th:checked="${review.rating == 4}">
                        <label for="star4">★</label>
                        
                        <input type="radio" id="star3" name="rating" value="3" th:checked="${review.rating == 3}">
                        <label for="star3">★</label>
                        
                        <input type="radio" id="star2" name="rating" value="2" th:checked="${review.rating == 2}">
                        <label for="star2">★</label>
                        
                        <input type="radio" id="star1" name="rating" value="1" th:checked="${review.rating == 1}">
                        <label for="star1">★</label>
                    </div>
                    <div class="rating-desc" id="ratingDesc">별점을 선택해주세요</div>
                </div>
                
                <!-- 리뷰 내용 -->
                <div class="form-group">
                    <label for="content">리뷰 내용<span class="required">*</span></label>
                    <textarea class="form-control textarea" 
                              id="content" 
                              name="content" 
                              placeholder="상품에 대한 솔직한 리뷰를 작성해주세요."
                              required
                              th:text="${review.content}"></textarea>
                    <div class="help-text">최소 10자 이상 작성해주세요.</div>
                </div>
                
                <!-- 기존 리뷰 이미지 -->
                <div class="form-group" th:if="${review.imageUrl != null}">
                    <label>현재 이미지</label>
                    <div class="image-preview">
                        <img th:src="${review.imageUrl}" alt="리뷰 이미지">
                    </div>
                </div>
                
                <!-- 리뷰 이미지 변경 -->
                <div class="form-group">
                    <label for="imageFile">리뷰 이미지 변경 (선택)</label>
                    <div class="file-upload-wrapper">
                        <label for="imageFile" class="file-upload-btn">
                            <i class="fas fa-camera"></i> 이미지 선택
                        </label>
                        <input type="file" 
                               id="imageFile" 
                               name="imageFile" 
                               accept="image/*"
                               onchange="previewImage(event)">
                    </div>
                    <div class="file-name" id="fileName">선택된 파일 없음</div>
                    <div class="help-text">JPG, PNG (최대 5MB)</div>
                    
                    <div class="image-preview" id="newImagePreview" style="display: none;">
                        <img id="preview" src="" alt="미리보기">
                    </div>
                </div>
                
                <!-- 버튼 -->
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-check"></i> 리뷰 수정
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="history.back()">
                        <i class="fas fa-times"></i> 취소
                    </button>
                </div>
            </form>
        </div>
    </main>
    
    <th:block layout:fragment="script">
        <script th:inline="javascript">
            // 별점 초기값 설명 표시
            const initialRating = /*[[${review.rating}]]*/ 0;
            const ratingDesc = document.getElementById('ratingDesc');
            const ratingDescriptions = {
                1: '⭐ 별로예요',
                2: '⭐⭐ 그저 그래요',
                3: '⭐⭐⭐ 보통이에요',
                4: '⭐⭐⭐⭐ 좋아요',
                5: '⭐⭐⭐⭐⭐ 최고예요!'
            };
            
            if (initialRating) {
                ratingDesc.textContent = ratingDescriptions[initialRating];
                ratingDesc.style.color = '#ff9900';
                ratingDesc.style.fontWeight = '600';
            }
            
            // 별점 선택 시 설명 변경
            const ratingInputs = document.querySelectorAll('input[name="rating"]');
            
            ratingInputs.forEach(input => {
                input.addEventListener('change', function() {
                    ratingDesc.textContent = ratingDescriptions[this.value];
                    ratingDesc.style.color = '#ff9900';
                    ratingDesc.style.fontWeight = '600';
                });
            });
            
            // 이미지 미리보기
            function previewImage(event) {
                const file = event.target.files[0];
                const fileName = document.getElementById('fileName');
                const preview = document.getElementById('newImagePreview');
                const previewImg = document.getElementById('preview');
                
                if (file) {
                    fileName.textContent = file.name;
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        previewImg.src = e.target.result;
                        preview.style.display = 'block';
                    }
                    reader.readAsDataURL(file);
                } else {
                    fileName.textContent = '선택된 파일 없음';
                    preview.style.display = 'none';
                }
            }
            
            // 폼 검증
            document.getElementById('reviewForm').addEventListener('submit', function(e) {
                const rating = document.querySelector('input[name="rating"]:checked');
                const content = document.getElementById('content').value.trim();
                
                if (!rating) {
                    e.preventDefault();
                    alert('별점을 선택해주세요.');
                    return false;
                }
                
                if (content.length < 10) {
                    e.preventDefault();
                    alert('리뷰 내용을 최소 10자 이상 작성해주세요.');
                    return false;
                }
            });
        </script>
    </th:block>
</body>
</html>
