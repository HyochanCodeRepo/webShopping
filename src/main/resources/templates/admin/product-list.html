<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layout/default}"
      lang="ko">
<head>
    <title>상품 관리</title>
    <th:block layout:fragment="css">
        <style>
            .product-list-container {
                max-width: 1400px;
                margin: 40px auto;
                padding: 0 20px;
            }
            
            /* 헤더 */
            .list-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 20px 0;
                border-bottom: 2px solid #232f3e;
                margin-bottom: 30px;
            }
            
            .list-title {
                font-size: 28px;
                font-weight: 700;
                color: #232f3e;
            }
            
            .header-buttons {
                display: flex;
                gap: 10px;
            }
            
            .btn-register {
                padding: 12px 24px;
                background: #ff9900;
                color: #fff;
                border: none;
                border-radius: 8px;
                font-size: 15px;
                font-weight: 600;
                cursor: pointer;
                text-decoration: none;
                display: inline-flex;
                align-items: center;
                gap: 8px;
                transition: all 0.3s;
            }
            
            .btn-register:hover {
                background: #e88b00;
            }
            
            .btn-back {
                padding: 12px 24px;
                background: #232f3e;
                color: #fff;
                border: none;
                border-radius: 8px;
                font-size: 15px;
                font-weight: 600;
                cursor: pointer;
                text-decoration: none;
                display: inline-flex;
                align-items: center;
                gap: 8px;
                transition: all 0.3s;
            }
            
            .btn-back:hover {
                background: #131921;
            }
            
            /* 상품 통계 */
            .product-stats {
                display: flex;
                gap: 20px;
                margin-bottom: 30px;
            }
            
            .stat-card {
                flex: 1;
                background: #fff;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            }
            
            .stat-label {
                font-size: 14px;
                color: #666;
                margin-bottom: 8px;
            }
            
            .stat-value {
                font-size: 28px;
                font-weight: 700;
                color: #232f3e;
            }
            
            /* 빈 목록 */
            .empty-list {
                text-align: center;
                padding: 80px 20px;
                background: #fff;
                border-radius: 8px;
            }
            
            .empty-icon {
                font-size: 80px;
                color: #ddd;
                margin-bottom: 20px;
            }
            
            .empty-text {
                font-size: 18px;
                color: #666;
                margin-bottom: 30px;
            }
            
            /* 상품 테이블 */
            .product-table {
                background: #fff;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            }
            
            .product-table table {
                width: 100%;
                border-collapse: collapse;
            }
            
            .product-table thead {
                background: #f7f7f7;
                border-bottom: 2px solid #e8e8e8;
            }
            
            .product-table th {
                padding: 16px;
                text-align: left;
                font-size: 14px;
                font-weight: 600;
                color: #333;
            }
            
            .product-table th.center {
                text-align: center;
            }
            
            .product-table tbody tr {
                border-bottom: 1px solid #f0f0f0;
                transition: background 0.2s;
            }
            
            .product-table tbody tr:hover {
                background: #f9f9f9;
            }
            
            .product-table td {
                padding: 16px;
                font-size: 14px;
                color: #333;
            }
            
            .product-table td.center {
                text-align: center;
            }
            
            /* 상품 정보 */
            .product-info {
                display: flex;
                align-items: center;
                gap: 15px;
            }
            
            .product-image {
                width: 80px;
                height: 80px;
                border: 1px solid #e8e8e8;
                border-radius: 4px;
                overflow: hidden;
                flex-shrink: 0;
            }
            
            .product-image img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            
            .product-details {
                flex: 1;
            }
            
            .product-name {
                font-size: 15px;
                font-weight: 600;
                color: #232f3e;
                margin-bottom: 5px;
                cursor: pointer;
            }
            
            .product-name:hover {
                color: #ff9900;
            }
            
            .product-category {
                font-size: 13px;
                color: #666;
            }
            
            /* 가격 */
            .price-info {
                display: flex;
                flex-direction: column;
                gap: 5px;
            }
            
            .original-price {
                font-size: 13px;
                color: #999;
                text-decoration: line-through;
            }
            
            .discount-price {
                font-size: 16px;
                font-weight: 700;
                color: #E31837;
            }
            
            .regular-price {
                font-size: 16px;
                font-weight: 700;
                color: #333;
            }
            
            .discount-badge {
                display: inline-block;
                background: #E31837;
                color: #fff;
                padding: 2px 6px;
                border-radius: 3px;
                font-size: 12px;
                font-weight: 700;
                margin-left: 5px;
            }
            
            /* 재고 */
            .stock-available {
                color: #067d62;
                font-weight: 600;
            }
            
            .stock-low {
                color: #ff9900;
                font-weight: 600;
            }
            
            .stock-out {
                color: #E31837;
                font-weight: 600;
            }
            
            /* 액션 버튼 */
            .action-buttons {
                display: flex;
                gap: 8px;
                justify-content: center;
            }
            
            .btn-action {
                padding: 8px 16px;
                border: 1px solid #ddd;
                background: #fff;
                border-radius: 4px;
                font-size: 13px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s;
            }
            
            .btn-action.edit {
                color: #232f3e;
                border-color: #232f3e;
            }
            
            .btn-action.edit:hover {
                background: #232f3e;
                color: #fff;
            }
            
            .btn-action.delete {
                color: #E31837;
                border-color: #E31837;
            }
            
            .btn-action.delete:hover {
                background: #E31837;
                color: #fff;
            }
            
            .btn-action.view {
                color: #067d62;
                border-color: #067d62;
            }
            
            .btn-action.view:hover {
                background: #067d62;
                color: #fff;
            }
            
            /* 반응형 */
            @media (max-width: 768px) {
                .list-header {
                    flex-direction: column;
                    gap: 15px;
                    align-items: flex-start;
                }
                
                .header-buttons {
                    width: 100%;
                    flex-direction: column;
                }
                
                .btn-register,
                .btn-back {
                    width: 100%;
                    justify-content: center;
                }
                
                .product-stats {
                    flex-direction: column;
                }
                
                .product-table {
                    overflow-x: auto;
                }
                
                .product-table table {
                    min-width: 800px;
                }
            }
        </style>
    </th:block>
</head>
<body>
    <main layout:fragment="content">
        <div class="product-list-container">
            <!-- 헤더 -->
            <div class="list-header">
                <h1 class="list-title">
                    <i class="fas fa-box"></i> 내 상품 관리
                </h1>
                <div class="header-buttons">
                    <a th:href="@{/admin}" class="btn-back">
                        <i class="fas fa-arrow-left"></i> 관리자 페이지
                    </a>
                    <a th:href="@{/admin/product/register}" class="btn-register">
                        <i class="fas fa-plus-circle"></i> 상품 등록
                    </a>
                </div>
            </div>
            
            <!-- 통계 -->
            <div class="product-stats">
                <div class="stat-card">
                    <div class="stat-label">전체 상품</div>
                    <div class="stat-value">
                        <span th:text="${products.size()}">0</span>개
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">재고 부족</div>
                    <div class="stat-value">
                        <span th:text="${#lists.size(products.?[stockQuantity <= 10])}">0</span>개
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">품절</div>
                    <div class="stat-value">
                        <span th:text="${#lists.size(products.?[stockQuantity <= 0])}">0</span>개
                    </div>
                </div>
            </div>
            
            <!-- 상품 목록이 비어있을 때 -->
            <div class="empty-list" th:if="${products.isEmpty()}">
                <div class="empty-icon">
                    <i class="fas fa-box-open"></i>
                </div>
                <p class="empty-text">등록된 상품이 없습니다.</p>
                <a th:href="@{/admin/product/register}" class="btn-register">
                    <i class="fas fa-plus-circle"></i> 첫 상품 등록하기
                </a>
            </div>
            
            <!-- 상품 테이블 -->
            <div class="product-table" th:unless="${products.isEmpty()}">
                <table>
                    <thead>
                        <tr>
                            <th style="width: 50px;">No</th>
                            <th style="width: 40%;">상품 정보</th>
                            <th class="center" style="width: 15%;">가격</th>
                            <th class="center" style="width: 10%;">재고</th>
                            <th class="center" style="width: 15%;">등록일</th>
                            <th class="center" style="width: 20%;">관리</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="product, iterStat : ${products}">
                            <!-- No -->
                            <td class="center" th:text="${iterStat.count}">1</td>
                            
                            <!-- 상품 정보 -->
                            <td>
                                <div class="product-info">
                                    <div class="product-image">
                                        <img th:src="${product.repImageUrl}" 
                                             th:alt="${product.productName}"
                                             onerror="this.src='/images/product-sample.jpg'">
                                    </div>
                                    <div class="product-details">
                                        <div class="product-name" 
                                             th:text="${product.productName}"
                                             th:onclick="|location.href='@{/product/detail/{id}(id=${product.id})}'|">
                                            상품명
                                        </div>
                                        <div class="product-category" 
                                             th:text="${product.category?.name}">
                                            카테고리
                                        </div>
                                    </div>
                                </div>
                            </td>
                            
                            <!-- 가격 -->
                            <td>
                                <div class="price-info">
                                    <!-- 할인이 있을 때 -->
                                    <div th:if="${product.discountRate != null and product.discountRate > 0}">
                                        <div class="original-price" 
                                             th:text="${#numbers.formatInteger(product.price, 0, 'COMMA') + '원'}">
                                            50,000원
                                        </div>
                                        <div>
                                            <span class="discount-price" 
                                                  th:text="${#numbers.formatInteger(product.discountPrice, 0, 'COMMA') + '원'}">
                                                45,000원
                                            </span>
                                            <span class="discount-badge" 
                                                  th:text="${product.discountRate + '%'}">
                                                10%
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <!-- 할인이 없을 때 -->
                                    <div th:unless="${product.discountRate != null and product.discountRate > 0}">
                                        <span class="regular-price" 
                                              th:text="${#numbers.formatInteger(product.price, 0, 'COMMA') + '원'}">
                                            50,000원
                                        </span>
                                    </div>
                                </div>
                            </td>
                            
                            <!-- 재고 -->
                            <td class="center">
                                <span th:if="${product.stockQuantity > 10}" 
                                      class="stock-available"
                                      th:text="${product.stockQuantity}">
                                    100
                                </span>
                                <span th:if="${product.stockQuantity > 0 and product.stockQuantity <= 10}" 
                                      class="stock-low"
                                      th:text="${product.stockQuantity}">
                                    5
                                </span>
                                <span th:if="${product.stockQuantity <= 0}" 
                                      class="stock-out">
                                    품절
                                </span>
                            </td>
                            
                            <!-- 등록일 -->
                            <td class="center" 
                                th:text="${#temporals.format(product.createdDate, 'yyyy-MM-dd')}">
                                2024-12-26
                            </td>
                            
                            <!-- 관리 버튼 -->
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-action view" 
                                            th:onclick="|location.href='@{/product/detail/{id}(id=${product.id})}'|">
                                        <i class="fas fa-eye"></i> 보기
                                    </button>
                                    <button class="btn-action edit" 
                                            th:onclick="|location.href='@{/admin/product/edit/{id}(id=${product.id})}'|">
                                        <i class="fas fa-edit"></i> 수정
                                    </button>
                                    <button class="btn-action delete" 
                                            th:onclick="|deleteProduct(${product.id})|">
                                        <i class="fas fa-trash"></i> 삭제
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>
    
    <th:block layout:fragment="script">
        <script>
            // 상품 삭제
            function deleteProduct(productId) {
                if (confirm('정말로 이 상품을 삭제하시겠습니까?\n삭제된 상품은 복구할 수 없습니다.')) {
                    location.href = '/admin/product/delete/' + productId;
                }
            }
        </script>
    </th:block>
</body>
</html>
