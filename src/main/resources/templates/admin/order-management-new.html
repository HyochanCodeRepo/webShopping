<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}"
      lang="ko">
<head>
    <title>Ï£ºÎ¨∏ Í¥ÄÎ¶¨</title>
    <th:block layout:fragment="css">
        <style>
            .order-management-container {
                max-width: 1400px;
                margin: 40px auto;
                padding: 0 20px;
            }
            
            .page-header {
                padding: 20px 0;
                border-bottom: 2px solid #232f3e;
                margin-bottom: 30px;
            }
            
            .page-title {
                font-size: 28px;
                font-weight: 700;
                color: #232f3e;
            }
            
            /* Í≤ÄÏÉâ ÌïÑÌÑ∞ */
            .search-filter-section {
                background: #fff;
                border-radius: 12px;
                padding: 25px;
                margin-bottom: 30px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            }
            
            .search-row {
                display: flex;
                gap: 15px;
                margin-bottom: 15px;
                flex-wrap: wrap;
            }
            
            .search-input-wrapper {
                flex: 1;
                min-width: 300px;
            }
            
            .search-input {
                width: 100%;
                padding: 12px 15px;
                border: 2px solid #e0e0e0;
                border-radius: 8px;
                font-size: 14px;
                transition: all 0.3s;
            }
            
            .search-input:focus {
                outline: none;
                border-color: #ff9900;
            }
            
            .date-filter-group {
                display: flex;
                gap: 10px;
                align-items: center;
            }
            
            .date-quick-btn {
                padding: 10px 16px;
                border: 2px solid #e0e0e0;
                background: #fff;
                border-radius: 6px;
                font-size: 13px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s;
            }
            
            .date-quick-btn:hover {
                border-color: #ff9900;
                background: #fff9f0;
            }
            
            .date-quick-btn.active {
                background: #ff9900;
                border-color: #ff9900;
                color: #fff;
            }
            
            .date-input {
                padding: 10px;
                border: 2px solid #e0e0e0;
                border-radius: 6px;
                font-size: 13px;
            }
            
            .sort-select {
                padding: 10px 15px;
                border: 2px solid #e0e0e0;
                border-radius: 6px;
                font-size: 13px;
                font-weight: 600;
                cursor: pointer;
            }
            
            .search-btn-group {
                display: flex;
                gap: 10px;
            }
            
            .search-btn, .reset-btn {
                padding: 12px 24px;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                border: none;
                transition: all 0.3s;
            }
            
            .search-btn {
                background: #ff9900;
                color: #fff;
            }
            
            .search-btn:hover {
                background: #e88b00;
            }
            
            .reset-btn {
                background: #f0f0f0;
                color: #333;
            }
            
            .reset-btn:hover {
                background: #e0e0e0;
            }
            
            /* ÏÉÅÌÉú ÌÉ≠ */
            .status-tabs {
                display: flex;
                gap: 10px;
                margin-bottom: 30px;
                flex-wrap: wrap;
            }
            
            .status-tab {
                padding: 12px 20px;
                border: 2px solid #e0e0e0;
                background: #fff;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s;
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .status-tab:hover {
                border-color: #ff9900;
                background: #fff9f0;
            }
            
            .status-tab.active {
                background: #ff9900;
                border-color: #ff9900;
                color: #fff;
            }
            
            .tab-count {
                background: rgba(0,0,0,0.1);
                padding: 2px 8px;
                border-radius: 12px;
                font-size: 12px;
            }
            
            .status-tab.active .tab-count {
                background: rgba(255,255,255,0.3);
            }
            
            /* Ï£ºÎ¨∏ ÌÖåÏù¥Î∏î */
            .orders-table {
                background: #fff;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            }
            
            .table-header {
                display: grid;
                grid-template-columns: 120px 100px 2fr 1fr 120px 150px 100px;
                gap: 15px;
                padding: 15px 20px;
                background: #f7f7f7;
                font-size: 13px;
                font-weight: 700;
                color: #666;
                border-bottom: 2px solid #e0e0e0;
            }
            
            .table-row {
                display: grid;
                grid-template-columns: 120px 100px 2fr 1fr 120px 150px 100px;
                gap: 15px;
                padding: 20px;
                border-bottom: 1px solid #f0f0f0;
                align-items: center;
                transition: all 0.3s;
            }
            
            .table-row:hover {
                background: #f9f9f9;
            }
            
            .order-number {
                font-size: 13px;
                font-weight: 600;
                color: #0066c0;
            }
            
            .customer-name {
                font-size: 14px;
                font-weight: 600;
                color: #232f3e;
            }
            
            .product-info {
                font-size: 13px;
                color: #666;
            }
            
            .product-name {
                font-size: 14px;
                font-weight: 600;
                color: #232f3e;
                margin-bottom: 3px;
            }
            
            .order-amount {
                font-size: 15px;
                font-weight: 700;
                color: #E31837;
            }
            
            .status-badge {
                display: inline-block;
                padding: 6px 12px;
                border-radius: 12px;
                font-size: 12px;
                font-weight: 700;
            }
            
            .status-pending {
                background: #fff3cd;
                color: #856404;
            }
            
            .status-confirmed {
                background: #d1ecf1;
                color: #0c5460;
            }
            
            .status-preparing {
                background: #cce5ff;
                color: #004085;
            }
            
            .status-shipped {
                background: #d4edda;
                color: #155724;
            }
            
            .status-delivered {
                background: #d4edda;
                color: #155724;
            }
            
            .status-cancelled {
                background: #f8d7da;
                color: #721c24;
            }
            
            .order-date {
                font-size: 13px;
                color: #666;
            }
            
            .btn-detail {
                padding: 8px 16px;
                background: #232f3e;
                color: #fff;
                border: none;
                border-radius: 6px;
                font-size: 13px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s;
            }
            
            .btn-detail:hover {
                background: #131921;
            }
            
            /* ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò */
            .pagination-wrapper {
                display: flex;
                justify-content: center;
                align-items: center;
                margin: 40px 0;
                gap: 10px;
            }
            
            .pagination {
                display: flex;
                gap: 5px;
                list-style: none;
                padding: 0;
                margin: 0;
            }
            
            .page-item {
                display: inline-block;
            }
            
            .page-link {
                display: flex;
                align-items: center;
                justify-content: center;
                min-width: 40px;
                height: 40px;
                padding: 0 12px;
                border: 1px solid #ddd;
                border-radius: 4px;
                background: #fff;
                color: #333;
                font-size: 14px;
                font-weight: 600;
                text-decoration: none;
                transition: all 0.3s;
                cursor: pointer;
            }
            
            .page-link:hover {
                border-color: #ff9900;
                color: #ff9900;
                background: #fff9f0;
            }
            
            .page-item.active .page-link {
                background: #ff9900;
                border-color: #ff9900;
                color: #fff;
            }
            
            .page-item.disabled .page-link {
                opacity: 0.5;
                cursor: not-allowed;
                pointer-events: none;
            }
            
            .page-info {
                margin-left: 20px;
                font-size: 14px;
                color: #666;
            }
            
            .empty-list {
                text-align: center;
                padding: 80px 20px;
                color: #999;
            }
            
            .empty-icon {
                font-size: 60px;
                margin-bottom: 15px;
            }
        </style>
    </th:block>
</head>
<body>
<main layout:fragment="content">
    <div class="order-management-container">
        <div class="page-header">
            <h1 class="page-title">üì¶ Ï£ºÎ¨∏ Í¥ÄÎ¶¨</h1>
        </div>
        
        <!-- Í≤ÄÏÉâ ÌïÑÌÑ∞ -->
        <div class="search-filter-section">
            <div class="search-row">
                <div class="search-input-wrapper">
                    <input type="text" 
                           id="searchKeyword" 
                           class="search-input" 
                           placeholder="Ï£ºÎ¨∏Î≤àÌò∏, Ï£ºÎ¨∏ÏûêÎ™Ö, ÏÉÅÌíàÎ™ÖÏúºÎ°ú Í≤ÄÏÉâ"
                           th:value="${keyword}">
                </div>
                
                <select id="sortBy" class="sort-select">
                    <option value="latest" th:selected="${sortBy == 'latest'}">ÏµúÏã†Ïàú</option>
                    <option value="amount_desc" th:selected="${sortBy == 'amount_desc'}">Í∏àÏï° ÎÜíÏùÄÏàú</option>
                    <option value="amount_asc" th:selected="${sortBy == 'amount_asc'}">Í∏àÏï° ÎÇÆÏùÄÏàú</option>
                </select>
                
                <div class="search-btn-group">
                    <button onclick="searchOrders()" class="search-btn">
                        <i class="fas fa-search"></i> Í≤ÄÏÉâ
                    </button>
                    <button onclick="resetFilters()" class="reset-btn">
                        <i class="fas fa-redo"></i> Ï¥àÍ∏∞Ìôî
                    </button>
                </div>
            </div>
            
            <div class="search-row">
                <div class="date-filter-group">
                    <button class="date-quick-btn" onclick="setDateFilter('today')">Ïò§Îäò</button>
                    <button class="date-quick-btn" onclick="setDateFilter('week')">7Ïùº</button>
                    <button class="date-quick-btn" onclick="setDateFilter('month')">30Ïùº</button>
                    <button class="date-quick-btn" onclick="setDateFilter('all')">Ï†ÑÏ≤¥</button>
                    <span style="margin: 0 10px;">|</span>
                    <input type="date" id="startDate" class="date-input" th:value="${startDate}">
                    <span>~</span>
                    <input type="date" id="endDate" class="date-input" th:value="${endDate}">
                </div>
            </div>
        </div>
        
        <!-- ÏÉÅÌÉú ÌÉ≠ -->
        <div class="status-tabs">
            <button class="status-tab" 
                    th:classappend="${status == null} ? 'active'"
                    onclick="filterByStatus('')">
                Ï†ÑÏ≤¥
                <span class="tab-count" th:text="${totalCount}">0</span>
            </button>
            <button class="status-tab"
                    th:classappend="${status?.name() == 'PENDING'} ? 'active'"
                    onclick="filterByStatus('PENDING')">
                Í≤∞Ï†úÎåÄÍ∏∞
                <span class="tab-count" th:text="${statusCounts['PENDING'] ?: 0}">0</span>
            </button>
            <button class="status-tab"
                    th:classappend="${status?.name() == 'CONFIRMED'} ? 'active'"
                    onclick="filterByStatus('CONFIRMED')">
                Ï£ºÎ¨∏ÌôïÏ†ï
                <span class="tab-count" th:text="${statusCounts['CONFIRMED'] ?: 0}">0</span>
            </button>
            <button class="status-tab"
                    th:classappend="${status?.name() == 'PREPARING'} ? 'active'"
                    onclick="filterByStatus('PREPARING')">
                Î∞∞ÏÜ°Ï§ÄÎπÑ
                <span class="tab-count" th:text="${statusCounts['PREPARING'] ?: 0}">0</span>
            </button>
            <button class="status-tab"
                    th:classappend="${status?.name() == 'SHIPPED'} ? 'active'"
                    onclick="filterByStatus('SHIPPED')">
                Î∞∞ÏÜ°Ï§ë
                <span class="tab-count" th:text="${statusCounts['SHIPPED'] ?: 0}">0</span>
            </button>
            <button class="status-tab"
                    th:classappend="${status?.name() == 'DELIVERED'} ? 'active'"
                    onclick="filterByStatus('DELIVERED')">
                Î∞∞ÏÜ°ÏôÑÎ£å
                <span class="tab-count" th:text="${statusCounts['DELIVERED'] ?: 0}">0</span>
            </button>
            <button class="status-tab"
                    th:classappend="${status?.name() == 'CANCELLED'} ? 'active'"
                    onclick="filterByStatus('CANCELLED')">
                Ï∑®ÏÜå
                <span class="tab-count" th:text="${statusCounts['CANCELLED'] ?: 0}">0</span>
            </button>
        </div>
        
        <!-- Ï£ºÎ¨∏ ÌÖåÏù¥Î∏î -->
        <div class="orders-table" th:if="${!orders.isEmpty()}">
            <div class="table-header">
                <div>Ï£ºÎ¨∏Î≤àÌò∏</div>
                <div>Ï£ºÎ¨∏Ïûê</div>
                <div>ÏÉÅÌíà</div>
                <div>Í∏àÏï°</div>
                <div>ÏÉÅÌÉú</div>
                <div>Ï£ºÎ¨∏ÏùºÏãú</div>
                <div>Í¥ÄÎ¶¨</div>
            </div>
            
            <div th:each="order : ${orders}" class="table-row">
                <div class="order-number" th:text="${order.orderId}">ORD001</div>
                <div class="customer-name" th:text="${order.recipientName}">ÌôçÍ∏∏Îèô</div>
                <div>
                    <div th:each="item, iterStat : ${order.items}" 
                         th:if="${iterStat.index < 2}">
                        <div class="product-name" th:text="${item.productName}">ÏÉÅÌíàÎ™Ö</div>
                    </div>
                    <div class="product-info" 
                         th:if="${order.items.size() > 2}"
                         th:text="'Ïô∏ ' + (${order.items.size()} - 2) + 'Í±¥'">
                        Ïô∏ 1Í±¥
                    </div>
                </div>
                <div class="order-amount">
                    <span th:text="${#numbers.formatInteger(order.totalPrice, 0, 'COMMA')}">89,000</span>Ïõê
                </div>
                <div>
                    <span class="status-badge"
                          th:classappend="${'status-' + #strings.toLowerCase(order.orderStatus)}"
                          th:text="${order.orderStatusDescription}">
                        Î∞∞ÏÜ°Ï§ë
                    </span>
                </div>
                <div class="order-date" 
                     th:text="${#temporals.format(order.orderDate, 'yyyy-MM-dd HH:mm')}">
                    2024-01-22 14:30
                </div>
                <div>
                    <button class="btn-detail" 
                            th:onclick="|location.href='/order/detail/' + ${order.orderId}|">
                        ÏÉÅÏÑ∏Î≥¥Í∏∞
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Îπà Î™©Î°ù -->
        <div class="empty-list" th:if="${orders.isEmpty()}">
            <div class="empty-icon">
                <i class="fas fa-box-open"></i>
            </div>
            <p>Ï£ºÎ¨∏ ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.</p>
        </div>
        
        <!-- ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò -->
        <div class="pagination-wrapper" th:if="${orderPage != null and orderPage.totalPages > 0}">
            <ul class="pagination">
                <li class="page-item" th:classappend="${orderPage.first} ? 'disabled'">
                    <a class="page-link" 
                       th:href="@{/admin/orders(keyword=${keyword}, status=${status?.name()}, startDate=${startDate}, endDate=${endDate}, sortBy=${sortBy}, page=${orderPage.number - 1})}"
                       th:if="${!orderPage.first}">
                        <i class="fas fa-chevron-left"></i> Ïù¥Ï†Ñ
                    </a>
                    <span class="page-link" th:if="${orderPage.first}">
                        <i class="fas fa-chevron-left"></i> Ïù¥Ï†Ñ
                    </span>
                </li>
                
                <li class="page-item" 
                    th:each="pageNum : ${#numbers.sequence(0, orderPage.totalPages - 1)}"
                    th:if="${pageNum >= (orderPage.number - 2) and pageNum <= (orderPage.number + 2)}"
                    th:classappend="${pageNum == orderPage.number} ? 'active'">
                    <a class="page-link" 
                       th:href="@{/admin/orders(keyword=${keyword}, status=${status?.name()}, startDate=${startDate}, endDate=${endDate}, sortBy=${sortBy}, page=${pageNum})}"
                       th:text="${pageNum + 1}">1</a>
                </li>
                
                <li class="page-item" th:classappend="${orderPage.last} ? 'disabled'">
                    <a class="page-link" 
                       th:href="@{/admin/orders(keyword=${keyword}, status=${status?.name()}, startDate=${startDate}, endDate=${endDate}, sortBy=${sortBy}, page=${orderPage.number + 1})}"
                       th:if="${!orderPage.last}">
                        Îã§Ïùå <i class="fas fa-chevron-right"></i>
                    </a>
                    <span class="page-link" th:if="${orderPage.last}">
                        Îã§Ïùå <i class="fas fa-chevron-right"></i>
                    </span>
                </li>
            </ul>
            
            <div class="page-info">
                <span th:text="${orderPage.number + 1}">1</span> / 
                <span th:text="${orderPage.totalPages}">10</span> ÌéòÏù¥ÏßÄ
                (Ï¥ù <span th:text="${orderPage.totalElements}">200</span>Í∞ú)
            </div>
        </div>
    </div>
</main>

<th:block layout:fragment="script">
    <script th:inline="javascript">
        // Í≤ÄÏÉâ Ïã§Ìñâ
        function searchOrders() {
            const keyword = document.getElementById('searchKeyword').value;
            const sortBy = document.getElementById('sortBy').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const status = /*[[${status?.name()}]]*/ '';
            
            let url = '/admin/orders?';
            if (keyword) url += 'keyword=' + encodeURIComponent(keyword) + '&';
            if (status) url += 'status=' + status + '&';
            if (startDate) url += 'startDate=' + startDate + '&';
            if (endDate) url += 'endDate=' + endDate + '&';
            url += 'sortBy=' + sortBy;
            
            window.location.href = url;
        }
        
        // ÏÉÅÌÉú ÌïÑÌÑ∞
        function filterByStatus(status) {
            const keyword = document.getElementById('searchKeyword').value;
            const sortBy = document.getElementById('sortBy').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            let url = '/admin/orders?';
            if (keyword) url += 'keyword=' + encodeURIComponent(keyword) + '&';
            if (status) url += 'status=' + status + '&';
            if (startDate) url += 'startDate=' + startDate + '&';
            if (endDate) url += 'endDate=' + endDate + '&';
            url += 'sortBy=' + sortBy;
            
            window.location.href = url;
        }
        
        // ÎÇ†Ïßú Îπ†Î•∏ ÌïÑÌÑ∞
        function setDateFilter(type) {
            const today = new Date();
            const endDate = today.toISOString().split('T')[0];
            let startDate;
            
            if (type === 'today') {
                startDate = endDate;
            } else if (type === 'week') {
                startDate = new Date(today.setDate(today.getDate() - 7)).toISOString().split('T')[0];
            } else if (type === 'month') {
                startDate = new Date(today.setDate(today.getDate() - 30)).toISOString().split('T')[0];
            } else if (type === 'all') {
                startDate = '';
                document.getElementById('startDate').value = '';
                document.getElementById('endDate').value = '';
                searchOrders();
                return;
            }
            
            document.getElementById('startDate').value = startDate;
            document.getElementById('endDate').value = endDate;
            searchOrders();
        }
        
        // ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî
        function resetFilters() {
            window.location.href = '/admin/orders';
        }
        
        // Enter ÌÇ§ Í≤ÄÏÉâ
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('searchKeyword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchOrders();
                }
            });
        });
    </script>
</th:block>
</body>
</html>
